<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Simple Comment Section</title>
    <link rel="stylesheet" href="style.css" />
  </head>
  <body>
    <div class="container">
      <h1>Simple Comment Section</h1>

      <form id="comment-form" onsubmit="submitComment(event)">
        <input type="text" id="name" placeholder="Your name" required />
        <textarea id="comment" placeholder="Your comment" required></textarea>
        <button type="submit">Post Comment</button>
      </form>

      <div id="comments-container">
        <!-- Comments will appear here -->
      </div>
    </div>

    <script type="module">
      // Import Firebase modules
      import { initializeApp } from "https://www.gstatic.com/firebasejs/11.0.2/firebase-app.js";
      import {
        getFirestore,
        collection,
        addDoc,
        query,
        orderBy,
        getDocs,
      } from "https://www.gstatic.com/firebasejs/11.0.2/firebase-firestore.js";

      // Firebase configuration
      const firebaseConfig = {
        apiKey: "AIzaSyB3iS5qPPC6kN8yjFQahO9AcWwZgxXaaMU",
        authDomain: "comment-e3556.firebaseapp.com",
        projectId: "comment-e3556",
        storageBucket: "comment-e3556.firebasestorage.app",
        messagingSenderId: "259784993988",
        appId: "1:259784993988:web:21f7c3c84ffcf2bc9ead91",
      };

      // Initialize Firebase
      const app = initializeApp(firebaseConfig);
      const db = getFirestore(app);

      console.log("Firebase initialized:", app); // Check Firebase initialization

      // Function to get comments from Firestore
      async function getComments() {
        const q = query(
          collection(db, "commentSection"),
          orderBy("timestamp", "desc")
        );
        const querySnapshot = await getDocs(q);
        const commentsContainer = document.getElementById("comments-container");

        // Ensure the comments-container is available before setting innerHTML
        if (!commentsContainer) {
          console.error("comments-container element not found.");
          return;
        }

        commentsContainer.innerHTML = ""; // Clear existing comments

        console.log("Fetching comments...");

        querySnapshot.forEach((doc) => {
          const commentData = doc.data();
          const commentElement = document.createElement("div");
          commentElement.classList.add("comment");

          commentElement.innerHTML = `
            <strong>${commentData.name}</strong>: ${commentData.comment}
          `;
          commentsContainer.appendChild(commentElement);
        });

        if (querySnapshot.empty) {
          console.log("No comments found.");
        }
      }

      // Function to submit comment
      async function submitComment(event) {
        event.preventDefault();

        const nameInput = document.getElementById("name");
        const commentInput = document.getElementById("comment");

        console.log("Name:", nameInput.value);
        console.log("Comment:", commentInput.value);

        if (nameInput.value && commentInput.value) {
          try {
            await addDoc(collection(db, "commentSection"), {
              name: nameInput.value,
              comment: commentInput.value,
              timestamp: new Date(),
            });

            console.log("Comment submitted successfully!");

            // Clear form
            nameInput.value = "";
            commentInput.value = "";

            // Reload comments
            getComments();
          } catch (error) {
            console.error("Error submitting comment:", error);
          }
        } else {
          alert("Please enter a name and a comment.");
        }
      }

      // Ensure DOM is loaded before accessing elements
      document.addEventListener("DOMContentLoaded", () => {
        // Fetch and display comments on page load
        getComments();
      });
    </script>
  </body>
</html>
