<script type="module">
  // Import Firebase modules
  import { initializeApp } from "https://www.gstatic.com/firebasejs/11.0.2/firebase-app.js";
  import {
    getFirestore,
    collection,
    addDoc,
    query,
    orderBy,
    getDocs,
  } from "https://www.gstatic.com/firebasejs/11.0.2/firebase-firestore.js";

  // Firebase configuration
  const firebaseConfig = {
    apiKey: "AIzaSyB3iS5qPPC6kN8yjFQahO9AcWwZgxXaaMU",
    authDomain: "comment-e3556.firebaseapp.com",
    projectId: "comment-e3556",
    storageBucket: "comment-e3556.firebasestorage.app",
    messagingSenderId: "259784993988",
    appId: "1:259784993988:web:21f7c3c84ffcf2bc9ead91",
  };

  // Initialize Firebase
  const app = initializeApp(firebaseConfig);
  const db = getFirestore(app);

  console.log("Firebase initialized:", app); // Check Firebase initialization

  // Function to get comments from Firestore
  async function getComments() {
    const q = query(
      collection(db, "commentSection"),
      orderBy("timestamp", "desc")
    );
    const querySnapshot = await getDocs(q);
    const commentsContainer = document.getElementById("comments-container");
    commentsContainer.innerHTML = ""; // Clear existing comments

    console.log("Fetching comments...");

    querySnapshot.forEach((doc) => {
      const commentData = doc.data();
      const commentElement = document.createElement("div");
      commentElement.classList.add("comment");

      commentElement.innerHTML = `
        <strong>${commentData.name}</strong>: ${commentData.comment}
      `;
      commentsContainer.appendChild(commentElement);
    });

    if (querySnapshot.empty) {
      console.log("No comments found.");
    }
  }

  // Function to submit comment
  async function submitComment(event) {
    event.preventDefault();

    const nameInput = document.getElementById("name");
    const commentInput = document.getElementById("comment");

    console.log("Name:", nameInput.value);
    console.log("Comment:", commentInput.value);

    if (nameInput.value && commentInput.value) {
      try {
        await addDoc(collection(db, "commentSection"), {
          name: nameInput.value,
          comment: commentInput.value,
          timestamp: new Date(),
        });

        console.log("Comment submitted successfully!");

        // Clear form
        nameInput.value = "";
        commentInput.value = "";

        // Reload comments
        getComments();
      } catch (error) {
        console.error("Error submitting comment:", error);
      }
    } else {
      alert("Please enter a name and a comment.");
    }
  }

  window.onload = () => {
    // Fetch and display comments on page load
    getComments();
  };
</script>
